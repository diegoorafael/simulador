<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matem√°tica do Carro | Diego</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00ff88; --bg: #000000; --card: #1c1c1e; --text: #ffffff; --grey: #a1a1aa; --red: #ff3b30; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 15px; }
        .app-container { max-width: 450px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; }
        .header { width: 100%; text-align: left; margin-bottom: 25px; }
        .header h1 { font-size: 28px; font-weight: 900; margin: 0; letter-spacing: -1.5px; }
        .header span { color: var(--primary); font-size: 14px; }
        .card { width: 100%; background: var(--card); border-radius: 20px; padding: 22px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .card-label { font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--grey); margin-bottom: 15px; display: block; text-align: center; }
        .input-group { margin-bottom: 20px; width: 100%; }
        .input-group label { display: block; font-size: 11px; color: #8b949e; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; }
        select, input { width: 100%; background: transparent; border: none; border-bottom: 2px solid rgba(255,255,255,0.2); padding: 10px 0; color: var(--text); font-size: 18px; font-weight: 600; transition: 0.3s; }
        select:focus, input:focus { border-color: var(--primary); }
        .chart-wrap { width: 100%; height: 230px; position: relative; margin-bottom: 15px; }
        .res-grid { width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
        .res-box { padding: 15px; background: rgba(255,255,255,0.05); border-radius: 16px; }
        .data-item { margin-bottom: 22px; width: 100%; }
        .data-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .data-title { font-size: 14px; font-weight: 700; color: var(--primary); }
        .data-value { font-size: 14px; font-weight: 900; }
        .data-desc { font-size: 12px; color: var(--grey); line-height: 1.5; text-align: left; }
        .btn-main { background: var(--primary); color: #000; border: none; width: 100%; padding: 20px; border-radius: 18px; font-weight: 900; font-size: 16px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>
<div class="app-container">
    <div class="header">
        <h1>Matem√°tica do Carro<span>.</span></h1>
        <span>Consultoria por Diego</span>
    </div>

    <div class="card">
        <span class="card-label">Configura√ß√£o do Duelo</span>
        <div class="input-group">
            <label>Modelo de Refer√™ncia</label>
            <select id="preset" onchange="aplicar()">
                <option value="tcross" data-fipe="165000" data-perc="2.15" selected>VW T-Cross Comfort</option>
                <option value="polo" data-fipe="125000" data-perc="2.2">VW Polo Highline</option>
                <option value="compass" data-fipe="225000" data-perc="2.35">Jeep Compass Limited</option>
                <option value="hilux" data-fipe="330000" data-perc="2.6">Toyota Hilux SRX</option>
            </select>
        </div>
        <div class="input-group"><label>Valor Tabela FIPE (R$)</label><input type="text" id="fipe" oninput="mask(this); calc()"></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
            <div class="input-group"><label>Finan. (% am)</label><input type="number" id="juros" value="1.45" step="0.01" oninput="calc()"></div>
            <div class="input-group"><label>Tempo (Meses)</label><input type="number" id="meses" value="36" oninput="calc()"></div>
        </div>
    </div>

    <div class="card" style="display: flex; flex-direction: column; align-items: center;">
        <span class="card-label">Patrim√¥nio L√≠quido Acumulado</span>
        <div class="chart-wrap"><canvas id="grafico"></canvas></div>
        <div class="res-grid">
            <div class="res-box"><small style="color:var(--red); font-weight: 800; font-size: 10px;">EM LATA</small><div id="vC" style="font-weight:900; font-size: 16px; margin-top: 5px;">R$ 0</div></div>
            <div class="res-box" style="border: 1px solid var(--primary);"><small style="color:var(--primary); font-weight: 800; font-size: 10px;">NO BANCO</small><div id="vA" style="font-weight:900; font-size: 16px; margin-top: 5px;">R$ 0</div></div>
        </div>
    </div>

    <div class="card" style="border-color: var(--primary)">
        <span class="card-label">An√°lise de Capital e Custos</span>
        
        <div class="data-item">
            <div class="data-header"><span class="data-title">Rentabilidade Selic</span><span id="res-selic-total" class="data-value" style="color: var(--primary)">R$ 0,00</span></div>
            <p class="data-desc">Este √© o **ganho real** de juros sobre o seu dinheiro. √â o motor do seu patrim√¥nio que transforma a economia mensal em riqueza acumulada atrav√©s dos juros compostos.</p>
        </div>

        <div class="data-item">
            <div class="data-header"><span class="data-title">Aporte Inicial + Sobra</span><span id="res-capital-base" class="data-value">R$ 0,00</span></div>
            <p class="data-desc">Somat√≥ria do valor de entrada (Aporte Inicial) mais as economias mensais (Sobra) que deixaram de ser pagas em juros banc√°rios e taxas.</p>
        </div>

        <div class="data-item">
            <div class="data-header"><span class="data-title" style="color: var(--red)">IPVA Din√¢mico</span><span id="res-ipva" class="data-value">R$ 0,00</span></div>
            <p class="data-desc">Imposto total pago ao governo. Calculado ano a ano sobre o valor depreciado da FIPE, simulando a redu√ß√£o real da guia.</p>
        </div>

        <div class="data-item">
            <div class="data-header"><span class="data-title" style="color: var(--red)">Seguro + Manuten√ß√£o</span><span id="res-seguro" class="data-value">R$ 0,00</span></div>
            <p class="data-desc">Gasto total com prote√ß√£o e oficina no per√≠odo, corrigido pela **Infla√ß√£o (IPCA)** mensal sobre pe√ßas e servi√ßos.</p>
        </div>
    </div>

    <button class="btn-main" onclick="gerarWhatsApp()">üì≤ Relat√≥rio @matematicadocarro</button>
</div>

<script>
let chart;
const selicAnual = 0.1275;
const ipcaAnual = 0.045;

function aplicar() {
    const s = document.getElementById('preset');
    const o = s.options[s.selectedIndex];
    document.getElementById('fipe').value = parseFloat(o.dataset.fipe).toLocaleString('pt-BR', {minimumFractionDigits:2});
    calc();
}

function mask(i) {
    let v = i.value.replace(/\D/g,'');
    v = (v/100).toFixed(2) + '';
    v = v.replace(".",",").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
    i.value = v;
}

function parse(v) { return parseFloat(v.toString().replace(/\./g,'').replace(',','.').replace('R$','').trim()) || 0; }

function calc() {
    const fipe = parse(document.getElementById('fipe').value);
    const n = parseInt(document.getElementById('meses').value) || 36;
    const jFinan = parseFloat(document.getElementById('juros').value) / 100;
    const entrada = fipe * 0.3;
    const s = document.getElementById('preset');
    const assinBase = fipe * (parseFloat(s.options[s.selectedIndex].dataset.perc)/100);

    let acumIpva = 0;
    let acumSeguroManut = 0;
    const custoBaseAnual = fipe * 0.05;

    for (let m = 1; m <= n; m++) {
        let ano = Math.floor((m-1)/12);
        if (m % 12 === 1) acumIpva += (fipe * Math.pow(0.88, ano)) * 0.04;
        acumSeguroManut += (custoBaseAnual / 12) * Math.pow(1 + (ipcaAnual/12), m);
    }

    const parc = (fipe - entrada) * (jFinan * Math.pow(1+jFinan, n)) / (Math.pow(1+jFinan, n) - 1);
    const sobraM = (parc + (acumIpva/n) + (acumSeguroManut/n)) - assinBase;

    const sm = Math.pow(1 + selicAnual, 1/12) - 1;
    let capAss = entrada, labs = [], dAss = [], dCom = [];
    let capitalBaseAcumulado = entrada;
    
    for(let i=0; i<=n; i++) {
        labs.push(i+"m");
        let vC = fipe * Math.pow(0.88, i/12);
        let sd = (fipe - entrada) * (Math.pow(1+jFinan, n) - Math.pow(1+jFinan, i)) / (Math.pow(1+jFinan, n) - 1);
        dCom.push(Math.max(0, vC - (i === n ? 0 : sd)));
        if(i > 0) {
            capAss = capAss * (1 + sm) + sobraM;
            capitalBaseAcumulado += sobraM;
        }
        dAss.push(capAss);
    }

    const rendimentoPuroSelic = capAss - capitalBaseAcumulado;

    document.getElementById('res-selic-total').innerText = rendimentoPuroSelic.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    document.getElementById('res-capital-base').innerText = capitalBaseAcumulado.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    document.getElementById('res-ipva').innerText = acumIpva.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    document.getElementById('res-seguro').innerText = acumSeguroManut.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    document.getElementById('vC').innerText = dCom[n].toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    document.getElementById('vA').innerText = dAss[n].toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('grafico').getContext('2d'), {
        type: 'line',
        data: { labels: labs, datasets: [
            { label: 'Banco', data: dAss, borderColor: '#00ff88', borderWidth: 4, pointRadius: 0, tension: 0.2 },
            { label: 'Lata', data: dCom, borderColor: '#ff3b30', borderWidth: 2, borderDash: [5,5], pointRadius: 0 }
        ]},
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });
}

function gerarWhatsApp() {
    const msg = `*üìä RELAT√ìRIO @MATEMATICADOCARRO*\n` +
        `Prazo: ${document.getElementById('meses').value} meses\n` +
        `Lucro Puro Selic: ${document.getElementById('res-selic-total').innerText}\n` +
        `Final no Banco: ${document.getElementById('vA').innerText}\n` +
        `_Simula√ß√£o Estrat√©gica by Diego_`;
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`, '_blank');
}
window.onload = () => { aplicar(); };
</script>
</body>
</html>
