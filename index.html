<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Autoselic PRO | Diego @matematicadocarro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #00ff88; --bg: #0a0e14; --card: #151b23; --text: #f0f6fc; --red: #ff4444; --orange: #ff9f43; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { background: var(--card); border: 1px solid #30363d; border-radius: 12px; padding: 20px; width: 100%; max-width: 1150px; }
        
        .selic-status { text-align: center; background: rgba(0, 255, 136, 0.1); border: 1px solid var(--primary); color: var(--primary); padding: 8px; border-radius: 8px; font-size: 13px; font-weight: bold; margin-bottom: 20px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .pulse { width: 10px; height: 10px; background: var(--primary); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .main-layout { display: flex; flex-direction: column; gap: 20px; }
        @media (min-width: 950px) { .main-layout { flex-direction: row; } }
        
        .inputs-section { flex: 1; display: flex; flex-direction: column; gap: 12px; }
        .chart-section { flex: 1.5; }

        .label-group { display: flex; flex-direction: column; gap: 5px; }
        .label-text { font-size: 11px; color: #8b949e; text-transform: uppercase; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 2px; }
        
        input, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: #fff; font-size: 15px; box-sizing: border-box; }

        .custos-info { background: #1c2128; border-radius: 10px; padding: 15px; border: 1px solid #30363d; margin-top: 10px; }
        .custo-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #2d333b; font-size: 12px; }
        .custo-v { color: var(--red); font-weight: bold; }

        .chart-container { background: #1c2128; border-radius: 10px; padding: 15px; height: 350px; position: relative; }
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .res-card { padding: 15px; border-radius: 12px; border: 1px solid #30363d; text-align: center; }
        .winner { border: 2px solid var(--primary); box-shadow: 0 0 20px rgba(0, 255, 136, 0.15); }
        
        .btn-primary { background: var(--primary); color: #000; border: none; padding: 18px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; text-transform: uppercase; margin-top: 20px; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <div class="selic-status">
        <div class="pulse"></div>
        TAXA SELIC ATUAL: <span id="selicDisplay">Calculando...</span>% A.A.
    </div>

    <h1 style="text-align: center; margin-bottom: 5px;">MATEM√ÅTICA DO CARRO</h1>
    <p style="text-align: center; color:#8b949e; margin-top:0; font-size:12px">Diego | Mentoria Autoselic</p>
    
    <div class="main-layout">
        <div class="inputs-section">
            <div class="label-group">
                <span class="label-text">Ve√≠culo (Localiza Meoo)</span>
                <select id="modeloPreset" onchange="aplicarPreset()">
                    <option value="polo" data-fipe="125000" data-perc="2.20">VW Polo Highline</option>
                    <option value="tcross" data-fipe="165000" data-perc="2.15" selected>VW T-Cross Comfortline</option>
                    <option value="compass" data-fipe="225000" data-perc="2.35">Jeep Compass Limited</option>
                    <option value="hilux" data-fipe="330000" data-perc="2.60">Toyota Hilux SRX</option>
                </select>
            </div>
            <div class="label-group"><span class="label-text">Valor FIPE (R$)</span><input type="text" id="vCarro" oninput="mask(this); calc()"></div>
            <div class="label-group"><span class="label-text">Entrada (R$)</span><input type="text" id="entrada" value="60.000,00" oninput="mask(this); calc()"></div>
            <div class="label-group"><span class="label-text">Taxa Financiamento (% AM)</span><input type="number" id="juros" value="1.45" step="0.01" oninput="calc()"></div>
            <div class="label-group"><span class="label-text">Tempo (Meses)</span><input type="number" id="meses" value="36" oninput="calc()"></div>

            <div class="custos-info">
                <div style="font-size:10px; color:var(--primary); font-weight:bold; margin-bottom:5px">CUSTOS REAIS (CARRO PR√ìPRIO)</div>
                <div class="custo-row"><span>IPVA (4% Anual)</span><span id="c-ipva" class="custo-v">R$ 0,00</span></div>
                <div class="custo-row"><span>Seguro Estimado</span><span id="c-seguro" class="custo-v">R$ 0,00</span></div>
                <div class="custo-row"><span>Manuten√ß√£o/Revis√£o</span><span id="c-manut" class="custo-v">R$ 0,00</span></div>
                <div class="custo-row" style="border:none; color:#fff; font-weight:bold"><span>Total Gasto</span><span id="c-total" style="color:var(--orange)">R$ 0,00</span></div>
            </div>
        </div>

        <div class="chart-section">
            <div class="chart-container"><canvas id="evolucaoChart"></canvas></div>
            <div style="margin-top:15px; font-size:11px; line-height:1.4; color:#abb2bf">
                <b>Por que a Selic importa?</b> Atualmente em <span id="selicTexto">--</span>%, ela define quanto o seu dinheiro rende enquanto voc√™ n√£o o "imobiliza" em um carro. No simulador, consideramos esse rendimento no cen√°rio de assinatura.
            </div>
        </div>
    </div>

    <div class="results-grid">
        <div id="cardComprador" class="res-card">
            <small>RESULTADO: COMPRA</small>
            <span id="resCompra" style="font-size:24px; font-weight:bold; color:var(--red); display:block;">R$ 0,00</span>
        </div>
        <div id="cardAssinante" class="res-card">
            <small>RESULTADO: ASSINATURA</small>
            <span id="resAssina" style="font-size:24px; font-weight:bold; color:var(--primary); display:block;">R$ 0,00</span>
        </div>
    </div>

    <button class="btn-primary" onclick="gerarWhatsApp()">üì≤ Enviar Relat√≥rio Detalhado</button>
</div>

<script>
let chart;
let selicAtual = 12.75;

async function atualizarSelic() {
    try {
        const response = await fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.11/dados/ultimos/1?formato=json');
        const data = await response.json();
        selicAtual = ((Math.pow((parseFloat(data[0].valor)/100) + 1, 252) - 1) * 100).toFixed(2);
        document.getElementById('selicDisplay').innerText = selicAtual;
        document.getElementById('selicTexto').innerText = selicAtual;
    } catch (e) {
        document.getElementById('selicDisplay').innerText = "12.75";
    }
    calc();
}

function aplicarPreset() {
    const sel = document.getElementById('modeloPreset');
    const opt = sel.options[sel.selectedIndex];
    document.getElementById('vCarro').value = parseFloat(opt.dataset.fipe).toLocaleString('pt-BR', {minimumFractionDigits: 2});
    calc();
}

function mask(i) {
    let v = i.value.replace(/\D/g, '');
    v = (v / 100).toFixed(2) + '';
    v = v.replace(".", ",").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
    i.value = v;
}

function parseMoney(v) { return parseFloat(v.toString().replace(/\./g, '').replace(',', '.').trim()) || 0; }

function calc() {
    const v = parseMoney(document.getElementById('vCarro').value);
    const e = parseMoney(document.getElementById('entrada').value);
    const n = parseInt(document.getElementById('meses').value);
    const jFinan = parseFloat(document.getElementById('juros').value) / 100;
    const sel = document.getElementById('modeloPreset');
    const a = v * (parseFloat(sel.options[sel.selectedIndex].dataset.perc) / 100);

    // Custos Ocultos (Foco do Diego Mec√¢nico)
    const ipva = v * 0.04;
    const seguro = v * 0.035; // M√©dia 3.5%
    const manut = v * 0.02;   // M√©dia 2% em 3 anos
    const totalOculto = (ipva + seguro) * (n/12) + manut;

    document.getElementById('c-ipva').innerText = ipva.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
    document.getElementById('c-seguro').innerText = seguro.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
    document.getElementById('c-manut').innerText = manut.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
    document.getElementById('c-total').innerText = totalOculto.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});

    const parcela = (v - e) * (jFinan * Math.pow(1 + jFinan, n)) / (Math.pow(1 + jFinan, n) - 1);
    
    let labels = [], dAssina = [], dCompra = [];
    let capital = e;
    const s_mensal = Math.pow(1 + (selicAtual/100), 1/12) - 1;

    for (let i = 0; i <= n; i++) {
        labels.push(i + "m");
        let vCarroDep = v * Math.pow(1 - 0.12/12, i);
        let sd = (v - e) * (Math.pow(1 + jFinan, n) - Math.pow(1 + jFinan, i)) / (Math.pow(1 + jFinan, n) - 1);
        dCompra.push(Math.max(0, vCarroDep - (i === n ? 0 : sd)));
        if (i > 0) {
            let custoM = parcela + (ipva/12) + (seguro/12) + (manut/n);
            capital = capital * (1 + s_mensal) + (custoM - a);
        }
        dAssina.push(capital);
    }

    document.getElementById('resCompra').innerText = dCompra[n].toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
    document.getElementById('resAssina').innerText = dAssina[n].toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
    document.getElementById('cardAssinante').className = dAssina[n] > dCompra[n] ? 'res-card winner' : 'res-card';

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('evolucaoChart').getContext('2d'), {
        type: 'line',
        data: { labels: labels, datasets: [
            { label: 'Dinheiro (Assinatura)', data: dAssina, borderColor: '#00ff88', borderWidth: 3, pointRadius: 0 },
            { label: 'Valor do Bem (Compra)', data: dCompra, borderColor: '#ff4444', borderDash: [5,5], pointRadius: 0 }
        ]},
        options: { responsive: true, maintainAspectRatio: false }
    });
}

function gerarWhatsApp() {
    const diff = parseMoney(document.getElementById('resAssina').innerText) - parseMoney(document.getElementById('resCompra').innerText);
    const msg = `*üìä RELAT√ìRIO @MATEMATICADOCARRO*\n` +
        `------------------------------------\n` +
        `üí° *Selic Atual:* ${selicAtual}% AA\n` +
        `üí∏ *Gasto Total Oculto (Compra):* ${document.getElementById('c-total').innerText}\n\n` +
        `üèÅ *Resultado:* Assinar te deixa *${diff.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}* mais rico.\n\n` +
        `_Simula√ß√£o Diego Autoselic_`;
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`, '_blank');
}
window.onload = () => { aplicarPreset(); atualizarSelic(); };
</script>
</body>
</html>
