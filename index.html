<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matem√°tica do Carro | Diego</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00ff88; --bg: #ffffff; --card: #f5f7f9; --text: #1a1d21; --red: #ff3b30; --grey: #8e8e93; }
        @media (prefers-color-scheme: dark) {
            :root { --bg: #000000; --card: #1c1c1e; --text: #ffffff; --grey: #a1a1aa; }
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 15px; }
        
        .app-container { max-width: 450px; margin: 0 auto; }
        
        .header { text-align: left; margin-bottom: 25px; padding: 10px; }
        .header h1 { font-size: 28px; font-weight: 900; margin: 0; letter-spacing: -1.5px; }
        .header span { color: var(--primary); font-size: 14px; font-weight: 500; }

        .market-info { display: flex; gap: 15px; margin-bottom: 20px; font-size: 11px; color: var(--grey); padding: 0 10px; }
        .market-info b { color: var(--text); }

        .card { background: var(--card); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(128,128,128,0.1); }
        .card-label { font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--grey); letter-spacing: 0.5px; margin-bottom: 15px; display: block; }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 12px; margin-bottom: 6px; font-weight: 600; color: var(--grey); }
        
        select, input { 
            width: 100%; background: transparent; border: none; border-bottom: 2px solid rgba(128,128,128,0.2);
            padding: 8px 0; color: var(--text); font-size: 17px; font-weight: 600; transition: 0.3s;
        }
        select:focus, input:focus { border-color: var(--primary); }

        .sobra-display { text-align: center; padding: 10px 0; }
        .sobra-amt { font-size: 34px; font-weight: 900; color: var(--primary); letter-spacing: -1.5px; }
        .sobra-desc { font-size: 11px; color: var(--grey); margin-top: 5px; font-weight: 500; }

        .costs-detail { margin-top: 15px; border-top: 1px solid rgba(128,128,128,0.1); padding-top: 15px; }
        .cost-row { display: flex; justify-content: space-between; font-size: 13px; padding: 6px 0; }
        .cost-row .val { font-weight: 700; color: var(--red); }

        .chart-wrap { height: 180px; margin: 15px 0; }

        .res-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .res-item { text-align: center; padding: 10px; background: rgba(128,128,128,0.05); border-radius: 12px; }
        .res-val { font-size: 16px; font-weight: 800; display: block; }
        .res-tag { font-size: 9px; font-weight: 700; color: var(--grey); text-transform: uppercase; }

        /* Estilo do Guia e Obje√ß√µes */
        .guide-section { margin-top: 30px; border-top: 2px solid var(--card); padding-top: 20px; }
        .guide-title { font-size: 18px; font-weight: 900; margin-bottom: 15px; color: var(--text); text-align: center; }
        .obj-box { margin-bottom: 15px; padding: 15px; background: var(--card); border-radius: 15px; }
        .obj-q { font-size: 13px; font-weight: 800; color: var(--red); margin-bottom: 5px; }
        .obj-a { font-size: 12px; line-height: 1.5; color: var(--text); }

        .checklist-item { display: flex; align-items: center; gap: 10px; font-size: 13px; margin-bottom: 10px; color: var(--text); }
        .check-icon { color: var(--primary); font-weight: 900; }

        .btn-main { 
            background: var(--text); color: var(--bg); border: none; width: 100%; 
            padding: 18px; border-radius: 16px; font-weight: 800; font-size: 15px;
            margin-top: 10px; transition: 0.3s; cursor: pointer;
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>Matem√°tica do Carro<span>.</span></h1>
        <span>Consultoria por Diego</span>
    </div>

    <div class="market-info">
        <span>Selic: <b id="selicVal">12.75%</b></span>
        <span>IPCA: <b>4.5%</b></span>
    </div>

    <div class="card">
        <span class="card-label">Entrada de Dados</span>
        <div class="input-group">
            <label>Modelo de Refer√™ncia</label>
            <select id="preset" onchange="aplicar()">
                <option value="tcross" data-fipe="165000" data-perc="2.15" selected>VW T-Cross Comfort</option>
                <option value="polo" data-fipe="125000" data-perc="2.2">VW Polo Highline</option>
                <option value="compass" data-fipe="225000" data-perc="2.35">Jeep Compass Limited</option>
                <option value="hilux" data-fipe="330000" data-perc="2.6">Toyota Hilux SRX</option>
            </select>
        </div>
        <div class="input-group">
            <label>Valor Tabela FIPE (R$)</label>
            <input type="text" id="fipe" oninput="mask(this); calc()">
        </div>
    </div>

    <div class="card">
        <span class="card-label">Fluxo de Caixa Mensal</span>
        <div class="sobra-display">
            <div id="v-sobra" class="sobra-amt">R$ 0,00</div>
            <div class="sobra-desc">Sobra mensal reinvestida na Selic</div>
        </div>
        
        <div class="costs-detail">
            <div class="cost-row"><span>Custos Compra (M√©dia)</span><span class="val" id="c-compra">R$ 0,00</span></div>
            <div class="cost-row"><span>Mensalidade Assinatura</span><span class="val" id="c-assin" style="color:var(--primary)">R$ 0,00</span></div>
        </div>
    </div>

    <div class="card">
        <span class="card-label">Patrim√¥nio L√≠quido (36 meses)</span>
        <div class="chart-wrap"><canvas id="grafico"></canvas></div>
        <div class="res-comparison">
            <div class="res-item"><span class="res-tag">Em Lata</span><span id="v-final-c" class="res-val" style="color:var(--red)">R$ 0,00</span></div>
            <div class="res-item"><span class="res-tag">No Banco</span><span id="v-final-a" class="res-val" style="color:var(--primary)">R$ 0,00</span></div>
        </div>
    </div>

    <button class="btn-main" onclick="gerarWhatsApp()">Gerar Relat√≥rio de Auditoria</button>

    <div class="guide-section">
        <div class="guide-title">Manual de Estrat√©gia</div>
        
        <div class="obj-box">
            <div class="obj-q">"Mas o carro √© meu no final?"</div>
            <div class="obj-a">O carro desvaloriza 12% ao ano. O assinante n√£o tem a lata, mas tem o <b>valor do carro em dinheiro l√≠quido</b> rendendo juros. O que voc√™ prefere no bolso?</div>
        </div>

        <div class="obj-box">
            <div class="obj-q">"Assinatura n√£o √© jogar dinheiro fora?"</div>
            <div class="obj-a">Jogar dinheiro fora √© pagar juros de financiamento e IPVA. Na assinatura, voc√™ paga pelo uso e investe a diferen√ßa.</div>
        </div>

        <div class="card" style="background: rgba(0, 255, 136, 0.05); border: 1px dashed var(--primary);">
            <span class="card-label" style="color: var(--text)">Checklist Estrat√©gico</span>
            <div class="checklist-item"><span class="check-icon">‚úì</span> Quero trocar de carro a cada 2-3 anos</div>
            <div class="checklist-item"><span class="check-icon">‚úì</span> Prefiro liquidez a patrim√¥nio imobilizado</div>
            <div class="checklist-item"><span class="check-icon">‚úì</span> N√£o quero me preocupar com IPVA/Oficina</div>
            <div class="checklist-item"><span class="check-icon">‚úì</span> Entendo que o banco ganha com meus juros</div>
            <p style="font-size: 10px; color: var(--grey); margin-top: 10px;">*Se marcou 3+, a assinatura √© sua melhor op√ß√£o.</p>
        </div>
    </div>
</div>

<script>
let selic = 12.75;
let ipca = 0.045;
let chart;

async function loadData() {
    try {
        const s = await fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.11/dados/ultimos/1?formato=json').then(r => r.json());
        selic = ((Math.pow((parseFloat(s[0].valor)/100) + 1, 252) - 1) * 100).toFixed(2);
        document.getElementById('selicVal').innerText = selic + '%';
    } catch(e) {}
    calc();
}

function aplicar() {
    const s = document.getElementById('preset');
    const o = s.options[s.selectedIndex];
    document.getElementById('fipe').value = parseFloat(o.dataset.fipe).toLocaleString('pt-BR', {minimumFractionDigits:2});
    calc();
}

function mask(i) {
    let v = i.value.replace(/\D/g,'');
    v = (v/100).toFixed(2) + '';
    v = v.replace(".",",").replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
    i.value = v;
}

function parse(v) { return parseFloat(v.toString().replace(/\./g,'').replace(',','.').replace('R$','').trim()) || 0; }

function calc() {
    const fipe = parse(document.getElementById('fipe').value);
    const n = 36;
    const jPrice = 0.0145;
    const entrada = fipe * 0.3;
    const sel = document.getElementById('preset');
    const assinBase = fipe * (parseFloat(sel.options[sel.selectedIndex].dataset.perc)/100);

    // C√°lculos de Custos (Comprador)
    const ipvaM = (fipe * 0.04) / 12; // M√©dia para simplifica√ß√£o visual
    const segM = (fipe * 0.035) / 12;
    const manM = (fipe * 0.015) / 12;
    const parc = (fipe - entrada) * (jPrice * Math.pow(1+jPrice, n)) / (Math.pow(1+jPrice, n) - 1);
    
    const custoCompradorTotalM = parc + ipvaM + segM + manM;
    const sobra = custoCompradorTotalM - assinBase;

    document.getElementById('c-compra').innerText = custoCompradorTotalM.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    document.getElementById('c-assin').innerText = assinBase.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    document.getElementById('v-sobra').innerText = sobra.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    // Proje√ß√£o Matem√°tica
    const sm = Math.pow(1 + (selic/100), 1/12) - 1;
    let capAss = entrada, labs = [], dAss = [], dCom = [];
    
    for(let i=0; i<=n; i++) {
        labs.push(i+"m");
        let vCarro = fipe * Math.pow(0.88, i/12);
        let sd = (fipe - entrada) * (Math.pow(1+jPrice, n) - Math.pow(1+jPrice, i)) / (Math.pow(1+jPrice, n) - 1);
        dCom.push(Math.max(0, vCarro - (i === n ? 0 : sd)));
        if(i > 0) {
            let reajusteAssin = Math.floor((i-1)/12);
            let vAssinCorrigida = assinBase * Math.pow(1 + ipca, reajusteAssin);
            capAss = capAss * (1 + sm) + (custoCompradorTotalM - vAssinCorrigida);
        }
        dAss.push(capAss);
    }

    document.getElementById('v-final-c').innerText = dCom[n].toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    document.getElementById('v-final-a').innerText = dAss[n].toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('grafico').getContext('2d'), {
        type: 'line',
        data: { labels: labs, datasets: [
            { label: 'Liquidez', data: dAss, borderColor: '#00ff88', borderWidth: 4, pointRadius: 0, tension: 0.4 },
            { label: 'Lata', data: dCom, borderColor: '#ff3b30', borderWidth: 2, borderDash: [5,5], pointRadius: 0 }
        ]},
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });
}

function gerarWhatsApp() {
    const diff = parse(document.getElementById('v-final-a').innerText) - parse(document.getElementById('v-final-c').innerText);
    const msg = `*üìä MATEM√ÅTICA DO CARRO*\n` +
        `Sobra Mensal Investida: ${document.getElementById('v-sobra').innerText}\n` +
        `Vantagem Patrimonial: +${diff.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}\n` +
        `_Simula√ß√£o Estrat√©gica by @matematicadocarro_`;
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`, '_blank');
}
window.onload = () => { loadData(); aplicar(); };
</script>
</body>
</html>
