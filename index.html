<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparador de Vantagem Patrimonial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card-stats { transition: transform 0.2s; }
        .card-stats:hover { transform: translateY(-5px); }
    </style>
</head>
<body class="p-2 md:p-6">
    <div class="max-w-5xl mx-auto">
        <div class="bg-white rounded-3xl p-6 mb-6 shadow-sm border border-gray-100 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-2xl font-black text-gray-800 uppercase tracking-tighter">Matemática do Carro</h1>
                <p class="text-gray-500 font-medium">Qual é a decisão financeira mais inteligente?</p>
            </div>
            <div class="bg-blue-50 px-4 py-2 rounded-2xl border border-blue-100">
                <span class="text-blue-700 font-bold text-sm">Projeção: 48 Meses</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 space-y-4">
                <div class="bg-white p-6 rounded-3xl shadow-sm space-y-4">
                    <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">⚙️ Ajustes de Mercado</h3>
                    
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase">Valor do Carro (Fipe)</label>
                        <input type="number" id="valorCarro" value="100000" class="w-full bg-gray-50 border-none p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold text-lg" oninput="calcular()">
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase">Selic (% a.a.)</label>
                            <input type="number" id="taxaSelic" value="13.75" step="0.25" class="w-full bg-gray-50 border-none p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold" oninput="calcular()">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase">IPCA (% a.a.)</label>
                            <input type="number" id="taxaIpca" value="4.5" step="0.1" class="w-full bg-gray-50 border-none p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold" oninput="calcular()">
                        </div>
                    </div>

                    <div class="pt-4 border-t border-gray-50">
                        <label class="text-xs font-bold text-gray-400 uppercase">Juros Financiamento (% a.m.)</label>
                        <input type="number" id="jurosFinan" value="1.3" step="0.1" class="w-full bg-gray-50 border-none p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold" oninput="calcular()">
                    </div>

                    <div class="pt-2">
                        <label class="text-xs font-bold text-gray-400 uppercase">Assinatura (% do Valor)</label>
                        <input type="number" id="percAssinatura" value="2.2" step="0.1" class="w-full bg-gray-50 border-none p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold" oninput="calcular()">
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                <div id="vencedorCard" class="p-8 rounded-[2rem] text-white shadow-2xl transition-all duration-500 flex flex-col items-center justify-center text-center">
                    <span class="text-xs font-bold uppercase tracking-[0.2em] mb-2 opacity-80">Conclusão Patrimonial</span>
                    <h2 id="vencedorNome" class="text-3xl font-black">Calculando...</h2>
                    <p id="vencedorDesc" class="mt-2 text-sm opacity-90 font-medium"></p>
                </div>

                <div class="bg-white p-6 rounded-3xl shadow-sm h-[350px]">
                    <canvas id="graficoVantagem"></canvas>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-6 rounded-3xl border-b-4 border-red-500 card-stats">
                        <p class="text-xs font-bold text-gray-400 uppercase">Patrimônio (Financiado)</p>
                        <h4 id="resFinan" class="text-2xl font-black text-gray-800 mt-1">R$ 0,00</h4>
                        <p class="text-[10px] text-gray-400 mt-2 uppercase italic">Carro usado + Investimento das sobras</p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border-b-4 border-blue-500 card-stats">
                        <p class="text-xs font-bold text-gray-400 uppercase">Patrimônio (Assinatura)</p>
                        <h4 id="resAssin" class="text-2xl font-black text-gray-800 mt-1">R$ 0,00</h4>
                        <p class="text-[10px] text-gray-400 mt-2 uppercase italic">Valor do carro rendendo + Aportes mensais</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chart;

        function calcular() {
            const valorCarro = parseFloat(document.getElementById('valorCarro').value) || 0;
            const selicAnual = parseFloat(document.getElementById('taxaSelic').value) / 100;
            const ipcaAnual = parseFloat(document.getElementById('taxaIpca').value) / 100;
            const jurosFinanMes = parseFloat(document.getElementById('jurosFinan').value) / 100;
            const percAssinatura = parseFloat(document.getElementById('percAssinatura').value) / 100;
            
            const meses = 48;
            const selicMensal = Math.pow(1 + selicAnual, 1/12) - 1;
            const ipcaMensal = Math.pow(1 + ipcaAnual, 1/12) - 1;

            // Variáveis de Patrimônio
            let capitalInvestidoAssin = valorCarro; // Dinheiro inicial rendendo na assinatura
            let capitalSobraFinan = 0; // Caso o financiamento seja mais barato (investe a sobra)
            let fipeAtual = valorCarro;
            
            let mensalidadeAssin = valorCarro * percAssinatura;
            const parcelaFinan = valorCarro * (jurosFinanMes * Math.pow(1 + jurosFinanMes, meses)) / (Math.pow(1 + jurosFinanMes, meses) - 1);

            let dadosFinan = [];
            let dadosAssin = [];

            for (let i = 1; i <= meses; i++) {
                // Financiamento: Custos de IPVA (cai com a Fipe) + Manut/Seguro (sobe com IPCA)
                fipeAtual *= 0.992; // 0.8% desvalorização mensal média
                let ipvaMes = (fipeAtual * 0.04) / 12;
                let manutSeguro = (valorCarro * 0.005) * Math.pow(1 + ipcaMensal, i);
                let totalMensalFinan = parcelaFinan + ipvaMes + manutSeguro;

                // Assinatura: Reajuste anual da mensalidade
                if (i % 12 === 0) mensalidadeAssin *= (1 + ipcaAnual);
                let totalMensalAssin = mensalidadeAssin;

                // Lógica da Sobra (Cash Flow)
                let sobra = totalMensalFinan - totalMensalAssin;

                // Atualiza Investimentos
                capitalInvestidoAssin *= (1 + selicMensal); // Capital inicial rendendo
                
                if (sobra > 0) {
                    capitalInvestidoAssin += sobra; // Sobra da assinatura vai pro investimento
                } else {
                    capitalSobraFinan += Math.abs(sobra);
                    capitalSobraFinan *= (1 + selicMensal);
                }

                dadosFinan.push(fipeAtual + capitalSobraFinan);
                dadosAssin.push(capitalInvestidoAssin);
            }

            atualizarDisplay(dadosFinan, dadosAssin);
        }

        function atualizarDisplay(df, da) {
            const finalFinan = df[df.length - 1];
            const finalAssin = da[da.length - 1];
            
            document.getElementById('resFinan').innerText = finalFinan.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
            document.getElementById('resAssin').innerText = finalAssin.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});

            const vCard = document.getElementById('vencedorCard');
            const vNome = document.getElementById('vencedorNome');
            const vDesc = document.getElementById('vencedorDesc');
            const vantagem = Math.abs(finalAssin - finalFinan).toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});

            if (finalAssin > finalFinan) {
                vCard.className = "p-8 rounded-[2rem] text-white shadow-2xl bg-gradient-to-br from-blue-600 to-indigo-800 flex flex-col items-center justify-center text-center scale-100";
                vNome.innerText = "ASSINATURA É MELHOR";
                vDesc.innerText = `Você termina com ${vantagem} a MAIS de patrimônio líquido em comparação ao financiamento.`;
            } else {
                vCard.className = "p-8 rounded-[2rem] text-white shadow-2xl bg-gradient-to-br from-slate-700 to-slate-900 flex flex-col items-center justify-center text-center";
                vNome.innerText = "FINANCIAMENTO É MELHOR";
                vDesc.innerText = `Neste cenário, possuir o carro e investir a sobra gera ${vantagem} a mais de patrimônio.`;
            }

            plotarGrafico(df, da);
        }

        function plotarGrafico(df, da) {
            const ctx = document.getElementById('graficoVantagem').getContext('2d');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 48}, (_, i) => i + 1),
                    datasets: [
                        { label: 'Patrimônio Assinatura', data: da, borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.3, borderWidth: 4 },
                        { label: 'Patrimônio Financiado', data: df, borderColor: '#ef4444', borderDash: [5, 5], tension: 0.3, borderWidth: 2 }
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: { y: { display: false }, x: { grid: { display: false } } },
                    plugins: { legend: { labels: { font: { weight: 'bold' } } } }
                }
            });
        }

        window.onload = calcular;
    </script>
</body>
</html>
